/**
 * AJAX Nette Framework plugin for jQuery
 *
 * @copyright Copyright (c) 2009, 2010 Jan Marek
 * @copyright Copyright (c) 2009, 2010 David Grudl
 * @copyright Copyright (c) 2012-2014 Vojtěch Dobeš
 * @license MIT
 *
 * @version 2.3.0
 */
(function(b,c,d){if(typeof c!=="function"){return console.error("nette.ajax.js: jQuery is missing, load it please")}var a=function(){var e={self:this,initialized:false,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var f=true;var h=Array.prototype.slice.call(arguments);var i=h.shift();var g=(typeof i==="string")?i:i.name;var j=(typeof i==="object")?i.off||{}:{};h.push(e.self);c.each(e.on[g],function(l,m){if(m===d||c.inArray(l,j)!==-1){return true}var k=m.apply(e.contexts[l],h);return f=(k===d||k)});return f},requestHandler:function(f){var g=e.self.ajax({},this,f);if(g&&g._returnFalse){return false}},ext:function(h,g,f){while(!f){f="ext_"+Math.random();if(e.contexts[f]){f=d}}c.each(h,function(i,j){e.on[i][f]=j});e.contexts[f]=c.extend(g?g:{},{name:function(){return f},ext:function(i,k){var j=e.contexts[i];if(!j&&k){throw"Extension '"+this.name()+"' depends on disabled extension '"+i+"'."}return j}})}};this.ext=function(f,h,g){if(typeof f==="object"){e.ext(f,h)}else{if(h===d){return e.contexts[f]}else{if(!h){c.each(["init","load","prepare","before","start","success","complete","error"],function(i,j){e.on[j][f]=d});e.contexts[f]=d}else{if(typeof f==="string"&&e.contexts[f]!==d){throw"Cannot override already registered nette-ajax extension '"+f+"'."}else{e.ext(h,g,f)}}}}return this};this.init=function(g,f){if(e.initialized){throw"Cannot initialize nette-ajax twice."}if(typeof g==="function"){this.ext("init",null);this.ext("init",{load:g},f)}else{if(typeof g==="object"){this.ext("init",null);this.ext("init",g,f)}else{if(g!==d){throw"Argument of init() can be function or function-hash only."}}}e.initialized=true;e.fire("init");this.load();return this};this.load=function(){e.fire("load",e.requestHandler);return this};this.ajax=function(h,i,k){if(c.type(h)==="string"){h={url:h}}if(!h.nette&&i&&k){var f=c(i),m,l;var g=h.nette={e:k,ui:i,el:f,isForm:f.is("form"),isSubmit:f.is("input[type=submit]")||f.is("button[type=submit]"),isImage:f.is("input[type=image]"),form:null};if(g.isSubmit||g.isImage){g.form=g.el.closest("form")}else{if(g.isForm){g.form=g.el}}if(!h.url){h.url=g.form?g.form.attr("action")||b.location.pathname+b.location.search:i.href}if(!h.type){h.type=g.form?g.form.attr("method"):"get"}if(f.is("[data-ajax-off]")){var j=f.attr("data-ajax-off");if(j.indexOf("[")===0){h.off=f.data("ajaxOff")}else{if(j.indexOf(",")!==-1){h.off=j.split(",")}else{if(j.indexOf(" ")!==-1){h.off=j.split(" ")}else{h.off=j}}}if(typeof h.off==="string"){h.off=[h.off]}h.off=c.grep(c.each(h.off,function(n){return c.trim(n)}),function(n){return n.length})}}e.fire({name:"prepare",off:h.off||{}},h);if(h.prepare){h.prepare(h)}l=h.beforeSend;h.beforeSend=function(p,o){var n=e.fire({name:"before",off:o.off||{}},p,o);if((n||n===d)&&l){n=l(p,o)}return n};return this.handleXHR(c.ajax(h),h)};this.handleXHR=function(g,f){f=f||{};if(g&&(typeof g.statusText==="undefined"||g.statusText!=="canceled")){g.done(function(i,h,j){e.fire({name:"success",off:f.off||{}},i,h,j,f)}).fail(function(j,h,i){e.fire({name:"error",off:f.off||{}},j,h,i,f)}).always(function(i,h){e.fire({name:"complete",off:f.off||{}},i,h,f)});e.fire({name:"start",off:f.off||{}},g,f);if(f.start){f.start(g,f)}}return g}};c.nette=new (c.extend(a,c.nette?c.nette:{}));c.fn.netteAjax=function(g,f){return c.nette.ajax(f||{},this[0],g)};c.fn.netteAjaxOff=function(){return this.off(".nette")};c.nette.ext("validation",{before:function(p,i){if(!i.nette){return true}else{var g=i.nette}var m=g.e;var n=c.extend(this.defaults,i.validate||(function(){if(!g.el.is("[data-ajax-validate]")){return}var e=g.el.data("ajaxValidate");if(e===false){return{keys:false,url:false,form:false}}else{if(typeof e==="object"){return e}}})()||{});var l=false;if(g.el.attr("data-ajax-pass")!==d){l=g.el.data("ajaxPass");l=typeof l==="bool"?l:true}if(n.keys){var h=m.button||m.ctrlKey||m.shiftKey||m.altKey||m.metaKey;if(g.form){if(h&&g.isSubmit){this.explicitNoAjax=true;return false}else{if(g.isForm&&this.explicitNoAjax){this.explicitNoAjax=false;return false}}}else{if(h){return false}}}if(n.form&&g.form){if(g.isSubmit||g.isImage){g.form.get(0)["nette-submittedBy"]=g.el.get(0)}var o;if((typeof Nette.version==="undefined"||Nette.version=="2.3")){var f=this.ie();o=(g.form.get(0).onsubmit&&g.form.get(0).onsubmit((typeof f!=="undefined"&&f<9)?d:m)===false)}else{o=((g.form.get(0).onsubmit?g.form.triggerHandler("submit"):Nette.validateForm(g.form.get(0)))===false)}if(o){m.stopImmediatePropagation();m.preventDefault();return false}}if(n.url){var j=g.form?i.url:g.el.attr("href");if(/(?:^[a-z][a-z0-9+.-]*:|\/\/)/.test(j)){var k=new URL(j);if(/:|^#/.test(k.pathname+k.search+k.hash)){return false}}else{if(/:|^#/.test(j)){return false}}}if(!l){m.stopPropagation();m.preventDefault();p._returnFalse=true}return true}},{defaults:{keys:true,url:true,form:true},explicitNoAjax:false,ie:function(g){var e=3;var h=document.createElement("div");var f=h.getElementsByTagName("i");while(h.innerHTML="<!--[if gt IE "+(++e)+"]><i></i><![endif]-->",f[0]){}return e>4?e:g}});c.nette.ext("forms",{init:function(){var e;if(!b.Nette||!(e=this.ext("snippets"))){return}e.after(function(f){f.find("form").each(function(){b.Nette.initForm(this)})})},prepare:function(j){var g=j.nette;if(!g||!g.form){return}var o=g.e;var q=j.data||{};var n={};if(g.isSubmit){n[g.el.attr("name")]=g.el.val()||""}else{if(g.isImage){var k=g.el.offset();var f=g.el.attr("name");var l=[Math.max(0,o.pageX-k.left),Math.max(0,o.pageY-k.top)];if(f.indexOf("[",0)!==-1){n[f]=l}else{n[f+".x"]=l[0];n[f+".y"]=l[1]}}}var p=g.form.attr("method");if(p&&p.toLowerCase()==="post"&&"FormData" in b){var h=new FormData(g.form[0]);for(var m in n){h.append(m,n[m])}if(typeof q!=="string"){for(var m in q){h.append(m,q[m])}}j.data=h;j.processData=false;j.contentType=false}else{if(typeof q!=="string"){q=c.param(q)}n=c.param(n);j.data=g.form.serialize()+(n?"&"+n:"")+"&"+q}}});c.nette.ext("snippets",{success:function(e){if(e.snippets){this.updateSnippets(e.snippets)}}},{beforeQueue:c.Callbacks(),afterQueue:c.Callbacks(),completeQueue:c.Callbacks(),before:function(e){this.beforeQueue.add(e)},after:function(e){this.afterQueue.add(e)},complete:function(e){this.completeQueue.add(e)},updateSnippets:function(h,e){var j=this;var k=[];for(var g in h){var f=this.getElement(g);if(f.get(0)){k.push(f.get(0))}this.updateSnippet(f,h[g],e)}c(k).promise().done(function(){j.completeQueue.fire()})},updateSnippet:function(g,f,e){if(g.is("title")){document.title=f}else{this.beforeQueue.fire(g);this.applySnippet(g,f,e);this.afterQueue.fire(g)}},getElement:function(e){return c("#"+this.escapeSelector(e))},applySnippet:function(g,f,e){if(!e&&g.is("[data-ajax-append]")){g.append(f)}else{if(!e&&g.is("[data-ajax-prepend]")){g.prepend(f)}else{if(g.html()!=f||/<[^>]*script/.test(f)){g.html(f)}}}},escapeSelector:function(e){return e.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,"\\$&")}});c.nette.ext("redirect",{success:function(e){if(e.redirect){b.location.href=e.redirect;return false}}});c.nette.ext("state",{success:function(e){if(e.state){this.state=e.state}}},{state:null});c.nette.ext("unique",{start:function(e){if(this.xhr){this.xhr.abort()}this.xhr=e},complete:function(){this.xhr=null}},{xhr:null});c.nette.ext("abort",{init:function(){c("body").keydown(c.proxy(function(f){if(this.xhr&&(f.keyCode.toString()==="27"&&!(f.ctrlKey||f.shiftKey||f.altKey||f.metaKey))){this.xhr.abort()}},this))},start:function(e){this.xhr=e},complete:function(){this.xhr=null}},{xhr:null});c.nette.ext("load",{success:function(){c.nette.load()}});c.nette.ext("init",{load:function(e){c(this.linkSelector).off("click.nette",e).on("click.nette",e);c(this.formSelector).off("submit.nette",e).on("submit.nette",e).off("click.nette",":image",e).on("click.nette",":image",e).off("click.nette",":submit",e).on("click.nette",":submit",e);c(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,e).on("click.nette",this.buttonSelector,e)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})})(window,window.jQuery);